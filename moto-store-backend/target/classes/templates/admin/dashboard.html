<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Panel de administraci√≥n - MotoStore</title>

    <!-- Bootstrap desde CDN (por si no carga el local) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">

    <!-- Si tienes bootstrap local, mantenlo tambi√©n -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>

    <style>
        body {
            background: #0f172a; /* azul muy oscuro */
            color: #e5e7eb;
            min-height: 100vh;
        }
        .navbar-brand span {
            font-weight: 700;
        }
        .card {
            border: none;
            border-radius: 1rem;
        }
        .card-header {
            border: none;
            border-radius: 1rem 1rem 0 0 !important;
        }
        .card-shadow {
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.6);
        }
        .badge-pill {
            border-radius: 999px;
        }
        .table thead {
            background: #0f172a;
            color: #e5e7eb;
        }
        .table tbody tr {
            background: #020617;
        }
        .table tbody tr:nth-child(even) {
            background: #020617;
        }
        .table {
            color: #e5e7eb;
        }
        .table tbody tr:hover {
            background: #111827;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: .03em;
            text-transform: uppercase;
            color: #9ca3af;
        }
        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
        }
        a, a:hover {
            text-decoration: none;
        }

        /* ===== Contenido del modal de soporte (tarjeta QR) ===== */
        .admin-contact-card {
            background: #020617;
            border-radius: 1rem;
            padding: 1.25rem;
            border: 1px solid rgba(148, 163, 184, 0.45);
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
            color: #e5e7eb;
        }

        .admin-contact-qr {
            background: #0b1120;
            border-radius: 0.9rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .admin-contact-qr img {
            max-width: 190px;
            display: block;
            margin: 0 auto;
        }

        .admin-contact-card .badge {
            background: rgba(16, 185, 129, 0.18);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.6);
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-black border-bottom border-secondary">
    <div class="container-fluid px-4">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <span class="me-2">üèçÔ∏è</span>
            <span>MotoStore <small class="text-secondary">Admin</small></span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#adminNavbar" aria-controls="adminNavbar"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="adminNavbar">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">
                <li class="nav-item me-lg-3">
                    <a class="nav-link" th:href="@{/}">Ver sitio p√∫blico</a>
                </li>

                <!-- NUEVO: enlace Soporte en la parte superior -->
                <li class="nav-item me-lg-3">
                    <a class="nav-link"
                       href="#"
                       data-bs-toggle="modal"
                       data-bs-target="#supportModal">
                        Soporte
                    </a>
                </li>

                <li class="nav-item me-lg-3">
                    <a class="nav-link" th:href="@{/admin/motos/new}">Agregar moto</a>
                </li>
                <li class="nav-item me-lg-3">
                    <a class="nav-link" th:href="@{/admin/sales}">Historial de ventas</a>
                </li>
                <li class="nav-item">
                    <a class="btn btn-outline-danger btn-sm" th:href="@{/logout}">
                        Cerrar sesi√≥n
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main class="container py-4 py-lg-5">

    <!-- CABECERA -->
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4">
        <div>
            <h1 class="h3 text-white mb-1">Panel de administraci√≥n</h1>
            <p class="text-secondary mb-0">
                Controla el cat√°logo de motos, monitorea ventas y revisa medios de pago.
            </p>
        </div>
        <div class="mt-3 mt-lg-0">
            <a th:href="@{/admin/motos/new}" class="btn btn-primary me-2">
                + Agregar moto
            </a>
            <a th:href="@{/admin/sales}" class="btn btn-outline-light">
                Ver historial de ventas
            </a>
        </div>
    </div>

    <!-- CARDS RESUMEN -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card card-shadow bg-gradient-primary"
                 style="background: radial-gradient(circle at top left, #38bdf8, #0f172a);">
                <div class="card-body">
                    <p class="text-uppercase small text-white-50 mb-1">Modelos activos</p>
                    <div class="d-flex justify-content-between align-items-end">
                        <span class="stat-number text-white"
                              th:text="${#lists.size(inventoryByModel)}">0</span>
                        <span class="badge bg-dark bg-opacity-50 badge-pill">Cat√°logo</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-shadow"
                 style="background: radial-gradient(circle at top left, #22c55e, #0f172a);">
                <div class="card-body">
                    <p class="text-uppercase small text-white-50 mb-1">Meses con ventas</p>
                    <div class="d-flex justify-content-between align-items-end">
                        <span class="stat-number text-white"
                              th:text="${#lists.size(monthlySales)}">0</span>
                        <span class="badge bg-dark bg-opacity-50 badge-pill">An√°lisis</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-shadow"
                 style="background: radial-gradient(circle at top left, #f97316, #0f172a);">
                <div class="card-body">
                    <p class="text-uppercase small text-white-50 mb-1">Medios de pago usados</p>
                    <div class="d-flex justify-content-between align-items-end">
                        <span class="stat-number text-white"
                              th:text="${#lists.size(paymentSummary)}">0</span>
                        <span class="badge bg-dark bg-opacity-50 badge-pill">Finanzas</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DOS COLUMNAS PRINCIPALES -->
    <div class="row g-4">
        <!-- COLUMNA IZQUIERDA -->
        <div class="col-lg-6">
            <!-- Inventario -->
            <div class="card card-shadow mb-4">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span class="section-title mb-0 text-uppercase">Inventario por referencia</span>
                    <span class="badge bg-secondary badge-pill">Marca + modelo</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0 align-middle">
                            <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th class="text-end">Cantidad en stock</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(inventoryByModel)}">
                                <td colspan="3" class="text-center text-secondary py-3">
                                    A√∫n no hay motos registradas.
                                    <a th:href="@{/admin/motos/new}" class="text-decoration-underline">
                                        Agrega la primera
                                    </a>.
                                </td>
                            </tr>
                            <tr th:each="row : ${inventoryByModel}">
                                <td th:text="${row.brand}">Suzuki</td>
                                <td th:text="${row.model}">GSX-150</td>
                                <td class="text-end">
                                    <span class="badge bg-primary badge-pill"
                                          th:text="${row.stock}">10</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- COLUMNA DERECHA -->
        <div class="col-lg-6">
            <!-- Ventas por mes -->
            <div class="card card-shadow mb-4">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span class="section-title mb-0 text-uppercase">Ventas por mes</span>
                    <span class="badge bg-info badge-pill text-dark">Resumen</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0 align-middle">
                            <thead>
                            <tr>
                                <th>A√±o</th>
                                <th>Mes</th>
                                <th class="text-end">Cant. ventas</th>
                                <th class="text-end">Total vendido</th>
                                <th class="text-end">Promedio</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(monthlySales)}">
                                <td colspan="5" class="text-center text-secondary py-3">
                                    A√∫n no hay ventas registradas.
                                </td>
                            </tr>
                            <tr th:each="m : ${monthlySales}">
                                <td th:text="${m.year}">2025</td>
                                <td th:text="${m.month}">11</td>
                                <td class="text-end" th:text="${m.saleCount}">5</td>
                                <td class="text-end" th:text="${#numbers.formatDecimal(m.totalAmount, 0, 'POINT', 0, 'COMMA')}">
                                    50.000.000
                                </td>
                                <td class="text-end" th:text="${#numbers.formatDecimal(m.avgAmount, 0, 'POINT', 0, 'COMMA')}">
                                    10.000.000
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Medios de pago -->
            <div class="card card-shadow">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span class="section-title mb-0 text-uppercase">Medios de pago (mes actual)</span>
                    <span class="badge bg-warning text-dark badge-pill">Pagos</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0 align-middle">
                            <thead>
                            <tr>
                                <th>Medio de pago</th>
                                <th class="text-end">Cant. ventas</th>
                                <th class="text-end">Total</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(paymentSummary)}">
                                <td colspan="3" class="text-center text-secondary py-3">
                                    A√∫n no hay pagos registrados este mes.
                                </td>
                            </tr>
                            <tr th:each="p : ${paymentSummary}">
                                <td th:text="${p.paymentMethod}">Tarjeta</td>
                                <td class="text-end" th:text="${p.count}">3</td>
                                <td class="text-end" th:text="${#numbers.formatDecimal(p.total, 0, 'POINT', 0, 'COMMA')}">
                                    15.000.000
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- MODAL DE SOPORTE CON QR -->
<div class="modal fade" id="supportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light border-0">
            <div class="modal-header border-0">
                <h5 class="modal-title">Soporte - Contacto del administrador</h5>
                <button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="admin-contact-card text-center">
                    <span class="badge mb-2">Soporte</span>
                    <h5 class="mb-1">Contacta con el administrador</h5>
                    <p class="small text-secondary mb-3">
                        Escanea este c√≥digo con la c√°mara de WhatsApp para a√±adirlo como contacto
                        y enviar un mensaje.
                    </p>

                    <div class="admin-contact-qr">
                        <img src="/img/admin/admin-whatsapp-qr.png"
                             alt="C√≥digo QR WhatsApp administrador">
                    </div>

                    <!-- Cambia el n√∫mero por el tuyo en formato internacional, solo d√≠gitos -->
                    <a href="https://wa.me/3043481459"
                       target="_blank"
                       class="btn btn-success btn-sm w-100 mt-2">
                        Abrir WhatsApp en el navegador
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
